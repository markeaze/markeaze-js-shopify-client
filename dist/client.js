!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){function n(e,t,r,n,a,i,o){try{var u=e[i](o),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,a)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(a,i){var o=e.apply(t,r);function u(e){n(o,a,i,u,c,"next",e)}function c(e){n(o,a,i,u,c,"throw",e)}u(void 0)}))}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}var c=r(1),s=function(){function e(){i(this,e)}var t;return u(e,null,[{key:"getCurrentCartItems",value:(t=a(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getShopifyCart();case 2:return r=t.sent,t.abrupt("return",r.items.map((function(t){return e.shopifyCartItemToMarkeazeCartItem(t)})));case 4:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"shopifyCartItemToMarkeazeCartItem",value:function(e){return{variant_id:"gid://shopify/ProductVariant/"+e.variant_id,qnt:e.quantity,price:e.price/100,name:e.title,url:window.location.origin+e.url,main_image_url:e.featured_image.url}}},{key:"compareAndUpdateCart",value:function(e){var t=sessionStorage.getItem("mkz_cart_items")||JSON.stringify([]),r=JSON.stringify(e);sessionStorage.setItem("mkz_cart_items",r),t!==r&&l.trackCartUpdate(e)}},{key:"_getShopifyCart",value:function(){return fetch("/cart.js").then((function(e){return e.json()})).catch((function(e){return console.error("[Markeaze]","Failed to get current cart from Shopify:",e),null}))}}]),e}(),l=function(){function e(){i(this,e)}var t;return u(e,null,[{key:"trackPageView",value:(t=a(regeneratorRuntime.mark((function e(){var t,r,n,a,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},"searchresults"!=(r=f.getPageMeta()).page.pageType){e.next=7;break}t.term=this._getQueryStringValue("q"),""!=t.term&&mkz("trackSearch",t),e.next=20;break;case 7:if("product"!=r.page.pageType){e.next=13;break}return e.next=10,f.getCurrentResourceInfo();case 10:n=e.sent,a=f.getSelectedVariant(n),t.offer={variant_id:"gid://shopify/ProductVariant/"+a.id,name:n.product.title,price:parseFloat(a.price),url:a.markeaze_offer_url};case 13:if("collection"!=r.page.pageType||"collection"!=r.page.resourceType){e.next=19;break}return e.next=16,f.getCurrentResourceInfo();case 16:i=e.sent,o=i.collection,t.category={uid:"gid://shopify/Collection/"+o.id,name:o.title};case 19:mkz("trackPageView",t);case 20:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"trackCartUpdate",value:function(e){mkz("trackCartUpdate",{items:e})}},{key:"_getQueryStringValue",value:function(e){return decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURIComponent(e).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))}}]),e}(),f=function(){function e(){i(this,e)}return u(e,null,[{key:"getSelectedVariant",value:function(e){var t,r=this._getSelectedVariantId(meta.page);return null===r?(t=e.product.variants[0]).markeaze_offer_url=this._getCanonicalUrl():(t=this._getProductVariantInfo(e.product.variants,r)).markeaze_offer_url=p.setQueryParam(this._getCanonicalUrl(),"variant",r),t}},{key:"getPageMeta",value:function(){if(void 0!==window.ShopifyAnalytics)return window.ShopifyAnalytics.meta}},{key:"getCurrentResourceInfo",value:function(){return fetch(window.location.pathname+".json").then((function(e){return e.json()})).catch((function(e){return console.error("[Markeaze]","Failed to get current resource info from Shopify:",e),null}))}},{key:"_getSelectedVariantId",value:function(e){return e.selectedVariantId||p.getQueryParam(window.location.href,"variant")}},{key:"_getProductVariantInfo",value:function(e,t){return e.find((function(e){return e.id==parseInt(t)}))}},{key:"_getCanonicalUrl",value:function(){for(var e=document.getElementsByTagName("meta"),t=0;t<e.length;t++)if("og:url"===e[t].getAttribute("property"))return e[t].getAttribute("content");for(var r=document.getElementsByTagName("link"),n=0;n<r.length;n++)if("canonical"===r[n].getAttribute("rel"))return r[n].getAttribute("href");return window.location.href}}]),e}(),p=function(){function e(){i(this,e)}var t;return u(e,null,[{key:"init",value:function(){if(window.sessionStorage){if(void 0!==document.currentScript)var e=document.currentScript.src;else{var t=document.getElementsByTagName("script");e=t[t.length-1].src}var r=this.getQueryParam(e,"app_key");void 0!==r?(this._createMarkeazePixel(),this._loadMarkeazeJSTracker(this._initMarkeazePixel(r)),this._initWatchURL()):console.error("[Markeaze]","Could not be initialized: no `app_key` param found in query URL for current script.")}}},{key:"_addXMLRequestCallback",value:function(e){var t,r;XMLHttpRequest.callbacks?XMLHttpRequest.callbacks.push(e):(XMLHttpRequest.callbacks=[e],t=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.send=function(){t.apply(this,arguments),this.onreadystatechange=function(e){for(r=0;r<XMLHttpRequest.callbacks.length;r++)XMLHttpRequest.callbacks[r](e)}})}},{key:"getQueryParam",value:function(e,t){return new URL(e).searchParams.get(t)}},{key:"setQueryParam",value:function(e,t,r){var n=new URL(e);return n.searchParams.set(t,r),n.toString()}},{key:"_loadMarkeazeJSTracker",value:function(e){var t=document.createElement("script");t.setAttribute("src",c.scriptUrl),t.setAttribute("type","text/javascript"),t.charset="utf-8",t.async=!0,t.onreadystatechange=t.onload=e,document.body.appendChild(t)}},{key:"_createMarkeazePixel",value:function(){var e;e=window,document,e.mkz=e.mkz||function(){(e.mkz.q=e.mkz.q||[]).push(arguments)}}},{key:"_initMarkeazePixel",value:(t=a(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return mkz("setDeviceUid",ShopifyAnalytics.lib.user().traits().uniqToken,!1),void 0!==(r=f.getPageMeta()).page.customerId&&mkz("setVisitorInfo",{client_id:r.page.customerId}),mkz("appKey",t),c.debug&&mkz("debug",!0),e.next=7,s.getCurrentCartItems();case 7:n=e.sent,s.compareAndUpdateCart(n),this._addXMLRequestCallback((function(e){if(4===e.target.readyState&&e.srcElement.responseText){var t=e.srcElement.responseText;try{var r=JSON.parse(t);if(void 0!==r.items){var n=r.items.map((function(e){return s.shopifyCartItemToMarkeazeCartItem(e)}));s.compareAndUpdateCart(n)}}catch(e){console.error(e)}}}));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_initWatchURL",value:function(){mkz("watch","url.change",(function(){l.trackPageView()}))}}]),e}();p.init()},function(e,t){var r={staging:{debug:!0,scriptUrl:"https://cdn.jsdelivr.net/gh/markeaze/markeaze-js-tracker@dev/dist/mkz.js",appId:"markeaze-dev"},production:{debug:!1,scriptUrl:"https://cdn.jsdelivr.net/gh/markeaze/markeaze-js-tracker@latest/dist/mkz.js",appId:"markeaze"}};e.exports=r.staging||r.staging}]);