!function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){function a(e,t,r,a,n,i,o){try{var c=e[i](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(a,n)}function n(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function c(e){a(o,n,i,c,s,"next",e)}function s(e){a(o,n,i,c,s,"throw",e)}c(void 0)}))}}var i=r(1);class o{static getCurrentCartItems(){var e=this;return n((function*(){return(yield e._getShopifyCart()).items.map(e=>o.shopifyCartItemToMarkeazeCartItem(e))}))()}static shopifyCartItemToMarkeazeCartItem(e){return{variant_id:"gid://shopify/ProductVariant/"+e.variant_id,qnt:e.quantity,price:e.price/100,name:e.title,url:window.location.origin+e.url,main_image_url:e.featured_image.url}}static compareAndUpdateCart(e){var t=sessionStorage.getItem("mkz_cart_items")||JSON.stringify([]),r=JSON.stringify(e);sessionStorage.setItem("mkz_cart_items",r),t!==r&&c.trackCartUpdate(e)}static _getShopifyCart(){return fetch("/cart.js").then((function(e){return e.json()})).catch((function(e){return console.error("[Markeaze]","Failed to get current cart from Shopify:",e),null}))}}class c{static trackPageView(){var e=this;return n((function*(){var t={},r=s.getPageMeta();if("searchresults"==r.page.pageType)t.term=e._getQueryStringValue("q"),""!=t.term&&mkz("trackSearch",t);else{if("product"==r.page.pageType){var a=yield s.getCurrentResourceInfo(),n=s.getSelectedVariant(a);t.offer={variant_id:"gid://shopify/ProductVariant/"+n.id,name:a.product.title,price:parseFloat(n.price),url:n.markeaze_offer_url}}if("collection"==r.page.pageType&&"collection"==r.page.resourceType){var i=(yield s.getCurrentResourceInfo()).collection;t.category={uid:"gid://shopify/Collection/"+i.id,name:i.title}}mkz("trackPageView",t)}}))()}static trackCartUpdate(e){mkz("trackCartUpdate",{items:e})}static _getQueryStringValue(e){return decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURIComponent(e).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))}}class s{static getSelectedVariant(e){var t,r=this._getSelectedVariantId(meta.page);return null===r?(t=e.product.variants[0]).markeaze_offer_url=this._getCanonicalUrl():(t=this._getProductVariantInfo(e.product.variants,r)).markeaze_offer_url=u.setQueryParam(this._getCanonicalUrl(),"variant",r),t}static getPageMeta(){if(void 0!==window.ShopifyAnalytics)return window.ShopifyAnalytics.meta}static getCurrentResourceInfo(){return fetch(window.location.pathname+".json").then((function(e){return e.json()})).catch((function(e){return console.error("[Markeaze]","Failed to get current resource info from Shopify:",e),null}))}static _getSelectedVariantId(e){return e.selectedVariantId||u.getQueryParam(window.location.href,"variant")}static _getProductVariantInfo(e,t){return e.find(e=>e.id==parseInt(t))}static _getCanonicalUrl(){for(var e=document.getElementsByTagName("meta"),t=0;t<e.length;t++)if("og:url"===e[t].getAttribute("property"))return e[t].getAttribute("content");for(var r=document.getElementsByTagName("link"),a=0;a<r.length;a++)if("canonical"===r[a].getAttribute("rel"))return r[a].getAttribute("href");return window.location.href}}class u{static init(){if(window.sessionStorage){if(void 0!==document.currentScript)var e=document.currentScript.src;else{var t=document.getElementsByTagName("script");e=t[t.length-1].src}var r=this.getQueryParam(e,"app_key");void 0!==r?(this._createMarkeazePixel(),this._loadMarkeazeJSTracker(this._initMarkeazePixel(r)),this._initWatchURL()):console.error("[Markeaze]","Could not be initialized: no `app_key` param found in query URL for current script.")}}static _addXMLRequestCallback(e){var t,r;XMLHttpRequest.callbacks?XMLHttpRequest.callbacks.push(e):(XMLHttpRequest.callbacks=[e],t=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.send=function(){t.apply(this,arguments),this.onreadystatechange=function(e){for(r=0;r<XMLHttpRequest.callbacks.length;r++)XMLHttpRequest.callbacks[r](e)}})}static getQueryParam(e,t){return new URL(e).searchParams.get(t)}static setQueryParam(e,t,r){var a=new URL(e);return a.searchParams.set(t,r),a.toString()}static _loadMarkeazeJSTracker(e){var t=document.createElement("script");t.setAttribute("src",i.scriptUrl),t.setAttribute("type","text/javascript"),t.charset="utf-8",t.async=!0,t.onreadystatechange=t.onload=e,document.body.appendChild(t)}static _createMarkeazePixel(){var e;e=window,document,e.mkz=e.mkz||function(){(e.mkz.q=e.mkz.q||[]).push(arguments)}}static _initMarkeazePixel(e){var t=this;return n((function*(){mkz("setDeviceUid",ShopifyAnalytics.lib.user().traits().uniqToken,!1);var r=s.getPageMeta();void 0!==r.page.customerId&&mkz("setVisitorInfo",{client_id:r.page.customerId}),mkz("appKey",e),i.debug&&mkz("debug",!0);var a=yield o.getCurrentCartItems();o.compareAndUpdateCart(a),t._addXMLRequestCallback((function(e){if(4===e.target.readyState&&e.srcElement.responseText){var t=e.srcElement.responseText;try{var r=JSON.parse(t);if(void 0!==r.items){var a=r.items.map(e=>o.shopifyCartItemToMarkeazeCartItem(e));o.compareAndUpdateCart(a)}}catch(e){console.error(e)}}}))}))()}static _initWatchURL(){mkz("watch","url.change",()=>{c.trackPageView()})}}u.init()},function(e,t){var r={staging:{debug:!0,scriptUrl:"https://cdn.jsdelivr.net/gh/markeaze/markeaze-js-tracker@dev/dist/mkz.js",appId:"markeaze-dev"},production:{debug:!1,scriptUrl:"https://cdn.jsdelivr.net/gh/markeaze/markeaze-js-tracker@latest/dist/mkz.js",appId:"markeaze"}};e.exports=r.staging||r.staging}]);