!function(t){var e={};function r(a){if(e[a])return e[a].exports;var n=e[a]={i:a,l:!1,exports:{}};return t[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(a,n,function(e){return t[e]}.bind(null,n));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){function a(t,e,r,a,n,i,o){try{var c=t[i](o),s=c.value}catch(t){return void r(t)}c.done?e(s):Promise.resolve(s).then(a,n)}function n(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var o=t.apply(e,r);function c(t){a(o,n,i,c,s,"next",t)}function s(t){a(o,n,i,c,s,"throw",t)}c(void 0)}))}}var i=r(1);class o{static getCurrentCartItems(){var t=this;return n((function*(){return(yield t._getShopifyCart()).items.map(t=>o.shopifyCartItemToMarkeazeCartItem(t))}))()}static addVariantToCart(t,e){var r=arguments,a=this;return n((function*(){var n=r.length>2&&void 0!==r[2]?r[2]:1,i=r.length>3&&void 0!==r[3]?r[3]:null;"string"==typeof t&&t.includes("/")&&(t=parseInt(t.split("/").pop()));var o={items:[{id:t,quantity:n}]};fetch("/cart/add.js",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(r=>{c.trackCartAddItem(t,n,e),a.__updateCurrentCartItems(),setTimeout(()=>{i()},200)}).catch(t=>{console.error("Error:",t)})}))()}static shopifyCartItemToMarkeazeCartItem(t){return{variant_id:"gid://shopify/ProductVariant/"+t.variant_id,qnt:t.quantity,price:t.price/100,name:t.title,url:window.location.origin+t.url,main_image_url:t.featured_image.url}}static compareAndUpdateCart(t){var e=sessionStorage.getItem("mkz_cart_items")||JSON.stringify([]),r=JSON.stringify(t);sessionStorage.setItem("mkz_cart_items",r),e!==r&&c.trackCartUpdate(t)}static openCartPage(){window.location.href="/cart"}static _getShopifyCart(){return fetch("/cart.js").then((function(t){return t.json()})).catch((function(t){return console.error("[Markeaze]","Failed to get current cart from Shopify:",t),null}))}static __updateCurrentCartItems(){var t=this;return n((function*(){var e=yield t.getCurrentCartItems();sessionStorage.setItem("mkz_cart_items",JSON.stringify(e))}))()}}class c{static trackPageView(){var t=this;return n((function*(){var e={},r=s.getPageMeta();if("searchresults"==r.page.pageType)e.term=t._getQueryStringValue("q"),""!=e.term&&mkz("trackSearch",e);else{if("product"==r.page.pageType){var a=yield s.getCurrentResourceInfo(),n=s.getSelectedVariant(a);e.offer={variant_id:"gid://shopify/ProductVariant/"+n.id,name:a.product.title,price:parseFloat(n.price),url:n.markeaze_offer_url}}if("collection"==r.page.pageType&&"collection"==r.page.resourceType){var i=(yield s.getCurrentResourceInfo()).collection;e.category={uid:"gid://shopify/Collection/"+i.id,name:i.title}}mkz("trackPageView",e)}}))()}static trackCartUpdate(t){mkz("trackCartUpdate",{items:t})}static trackCartAddItem(t,e,r){mkz("trackCartAddItem",{item:{variant_id:t,qnt:e,price:r}})}static _getQueryStringValue(t){return decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]"+encodeURIComponent(t).replace(/[\.\+\*]/g,"\\$&")+"(?:\\=([^&]*))?)?.*$","i"),"$1"))}}class s{static getSelectedVariant(t){var e,r=this._getSelectedVariantId(meta.page);return null===r?(e=t.product.variants[0]).markeaze_offer_url=this._getCanonicalUrl():(e=this._getProductVariantInfo(t.product.variants,r)).markeaze_offer_url=u.setQueryParam(this._getCanonicalUrl(),"variant",r),e}static getPageMeta(){if(void 0!==window.ShopifyAnalytics)return window.ShopifyAnalytics.meta}static getCurrentResourceInfo(){return fetch(window.location.pathname+".json").then((function(t){return t.json()})).catch((function(t){return console.error("[Markeaze]","Failed to get current resource info from Shopify:",t),null}))}static _getSelectedVariantId(t){return t.selectedVariantId||u.getQueryParam(window.location.href,"variant")}static _getProductVariantInfo(t,e){return t.find(t=>t.id==parseInt(e))}static _getCanonicalUrl(){for(var t=document.getElementsByTagName("meta"),e=0;e<t.length;e++)if("og:url"===t[e].getAttribute("property"))return t[e].getAttribute("content");for(var r=document.getElementsByTagName("link"),a=0;a<r.length;a++)if("canonical"===r[a].getAttribute("rel"))return r[a].getAttribute("href");return window.location.href}}class u{static init(){if(window.sessionStorage){if(void 0!==document.currentScript)var t=document.currentScript.src;else{var e=document.getElementsByTagName("script");t=e[e.length-1].src}var r=this.getQueryParam(t,"app_key");void 0!==r?(this._createMarkeazePixel(),this._loadMarkeazeJSTracker(this._initMarkeazePixel(r)),this._initWatchURL()):console.error("[Markeaze]","Could not be initialized: no `app_key` param found in query URL for current script.")}}static _addXMLRequestCallback(t){var e,r;XMLHttpRequest.callbacks?XMLHttpRequest.callbacks.push(t):(XMLHttpRequest.callbacks=[t],e=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.send=function(){e.apply(this,arguments),this.onreadystatechange=function(t){for(r=0;r<XMLHttpRequest.callbacks.length;r++)XMLHttpRequest.callbacks[r](t)}})}static getQueryParam(t,e){return new URL(t).searchParams.get(e)}static setQueryParam(t,e,r){var a=new URL(t);return a.searchParams.set(e,r),a.toString()}static _loadMarkeazeJSTracker(t){var e=document.createElement("script");e.setAttribute("src",i.scriptUrl),e.setAttribute("type","text/javascript"),e.charset="utf-8",e.async=!0,e.onreadystatechange=e.onload=t,document.body.appendChild(e)}static _createMarkeazePixel(){var t;t=window,document,t.mkz=t.mkz||function(){(t.mkz.q=t.mkz.q||[]).push(arguments)}}static _initMarkeazePixel(t){return n((function*(){i.debug&&mkz("debug",!0),mkz("setDeviceUid",ShopifyAnalytics.lib.user().traits().uniqToken,!1);var e=s.getPageMeta();void 0!==e.page.customerId&&mkz("setVisitorInfo",{client_id:e.page.customerId}),mkz("appKey",t);var r=yield o.getCurrentCartItems();o.compareAndUpdateCart(r),void 0!==window.$&&$.ajaxSetup({success:t=>{if(void 0!==t.items){var e=t.items.map(t=>o.shopifyCartItemToMarkeazeCartItem(t));o.compareAndUpdateCart(e)}}})}))()}static _initWatchURL(){mkz("watch","url.change",()=>{c.trackPageView()})}}window.mkzCartManager=o,u.init()},function(t,e){var r={staging:{debug:!0,scriptUrl:"https://cdn.jsdelivr.net/gh/markeaze/markeaze-js-tracker@dev/dist/mkz.js",appId:"markeaze-dev"},production:{debug:!1,scriptUrl:"https://cdn.jsdelivr.net/gh/markeaze/markeaze-js-tracker@latest/dist/mkz.js",appId:"markeaze"}};t.exports=r.staging||r.staging}]);